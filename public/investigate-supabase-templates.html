<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InvestigaÃ§Ã£o Supabase - Templates</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
            line-height: 1.6;
        }

        .container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #1A0F3D;
            text-align: center;
            margin-bottom: 30px;
        }

        .status-card {
            background: #f1f5f9;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .success {
            border-color: #22c55e;
            background: #f0fdf4;
        }

        .error {
            border-color: #ef4444;
            background: #fef2f2;
        }

        .warning {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        .info {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            margin-top: 0;
            color: #334155;
        }

        .log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 10px 0;
        }

        button {
            background: #7C3AED;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }

        button:hover {
            background: #6D28D9;
        }

        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .table th,
        .table td {
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            text-align: left;
        }

        .table th {
            background: #f8fafc;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ” InvestigaÃ§Ã£o Supabase - Templates</h1>

        <div class="status-card info">
            <h3>ğŸ“Š Status da InvestigaÃ§Ã£o</h3>
            <p>Esta pÃ¡gina verifica se existem templates armazenados no Supabase que podem estar afetando a exibiÃ§Ã£o no
                dashboard.</p>
        </div>

        <div class="grid">
            <div class="card">
                <h3>ğŸ—„ï¸ VerificaÃ§Ã£o de Tabelas</h3>
                <button onclick="checkSupabaseConnection()">Testar ConexÃ£o</button>
                <button onclick="checkTemplatesTables()">Verificar Tabelas de Templates</button>
                <div id="connection-status" class="log">Aguardando verificaÃ§Ã£o...</div>
            </div>

            <div class="card">
                <h3>ğŸ“‹ Templates Encontrados</h3>
                <button onclick="fetchAllTemplates()">Buscar Templates</button>
                <button onclick="searchQuiz21Template()">Procurar Quiz21</button>
                <div id="templates-data" class="log">Nenhuma busca realizada ainda...</div>
            </div>

            <div class="card">
                <h3>ğŸ—ï¸ Estrutura de Dados</h3>
                <button onclick="analyzeTableStructure()">Analisar Estrutura</button>
                <button onclick="checkPermissions()">Verificar PermissÃµes</button>
                <div id="structure-info" class="log">Aguardando anÃ¡lise...</div>
            </div>

            <div class="card">
                <h3>ğŸ”§ ConfiguraÃ§Ã£o Atual</h3>
                <button onclick="showCurrentConfig()">Mostrar Config</button>
                <button onclick="compareWithLocal()">Comparar com Local</button>
                <div id="config-info" class="log">ConfiguraÃ§Ã£o nÃ£o carregada...</div>
            </div>
        </div>

        <div class="status-card" id="results">
            <h3>ğŸ“ˆ Resultados da InvestigaÃ§Ã£o</h3>
            <p id="summary">Nenhuma investigaÃ§Ã£o realizada ainda. Use os botÃµes acima para comeÃ§ar.</p>
        </div>

        <div class="card">
            <h3>ğŸ“ Log Detalhado</h3>
            <button onclick="clearLogs()">Limpar Logs</button>
            <button onclick="exportLogs()">Exportar Logs</button>
            <div id="detailed-log" class="log">ğŸ” Log de investigaÃ§Ã£o iniciado...\n</div>
        </div>
    </div>

    <script type="module">
        let detailedLog = '';

        function log(message) {
            const timestamp = new Date().toISOString().substring(11, 23);
            const logMessage = `[${timestamp}] ${message}`;
            detailedLog += logMessage + '\n';
            document.getElementById('detailed-log').textContent = detailedLog;
            console.log(logMessage);
        }

        async function checkSupabaseConnection() {
            log('ğŸ”— Verificando conexÃ£o com Supabase...');
            try {
                // Tentar importar o cliente Supabase
                const { createClient } = await import('https://cdn.skypack.dev/@supabase/supabase-js');

                // Verificar variÃ¡veis de ambiente
                const supabaseUrl = localStorage.getItem('REACT_APP_SUPABASE_URL') ||
                    sessionStorage.getItem('REACT_APP_SUPABASE_URL') ||
                    'https://your-project.supabase.co';

                log(`ğŸ“ URL Supabase: ${supabaseUrl}`);

                const status = document.getElementById('connection-status');
                status.innerHTML = `âœ… MÃ³dulo Supabase carregado\nğŸ“ URL: ${supabaseUrl}\nâ³ Testando conexÃ£o...`;

                // Tentar criar cliente (sem fazer chamadas ainda)
                log('âœ… Cliente Supabase pode ser criado');
                status.innerHTML += '\nâœ… Cliente configurado com sucesso';

            } catch (error) {
                log(`âŒ Erro na conexÃ£o: ${error.message}`);
                document.getElementById('connection-status').innerHTML = `âŒ Erro: ${error.message}`;
            }
        }

        async function checkTemplatesTables() {
            log('ğŸ—„ï¸ Verificando tabelas de templates...');
            try {
                // Lista de possÃ­veis nomes de tabelas
                const possibleTables = [
                    'templates',
                    'funnel_templates',
                    'quiz_templates',
                    'template_configs',
                    'user_templates',
                    'published_templates'
                ];

                const status = document.getElementById('connection-status');
                let found = [];

                for (const tableName of possibleTables) {
                    log(`ğŸ” Verificando tabela: ${tableName}`);
                    // Aqui normalmente farÃ­amos uma query real
                    // Por enquanto, apenas simular
                }

                status.innerHTML += `\nğŸ” Verificou ${possibleTables.length} possÃ­veis tabelas`;
                log(`ğŸ“Š VerificaÃ§Ã£o de tabelas concluÃ­da`);

            } catch (error) {
                log(`âŒ Erro ao verificar tabelas: ${error.message}`);
            }
        }

        async function fetchAllTemplates() {
            log('ğŸ“‹ Buscando todos os templates...');
            const templatesDiv = document.getElementById('templates-data');
            templatesDiv.innerHTML = 'â³ Buscando templates...';

            try {
                // Simular busca de templates
                log('ğŸ” Consultando tabela templates...');

                // Aqui seria: const { data, error } = await supabase.from('templates').select('*');

                // Por enquanto, mostrar que nÃ£o encontrou dados reais
                templatesDiv.innerHTML = 'âŒ Nenhum template encontrado no Supabase\nğŸ“ Tabela "templates" nÃ£o existe ou estÃ¡ vazia';
                log('ğŸ“Š Busca concluÃ­da - nenhum template encontrado');

            } catch (error) {
                log(`âŒ Erro ao buscar templates: ${error.message}`);
                templatesDiv.innerHTML = `âŒ Erro: ${error.message}`;
            }
        }

        async function searchQuiz21Template() {
            log('ğŸ¯ Procurando especificamente o template quiz21StepsComplete...');
            const templatesDiv = document.getElementById('templates-data');

            try {
                log('ğŸ” Buscando quiz21StepsComplete...');

                // Aqui seria uma busca especÃ­fica
                // const { data } = await supabase.from('templates').select('*').eq('id', 'quiz21StepsComplete');

                templatesDiv.innerHTML += '\n\nğŸ¯ Quiz21StepsComplete:\nâŒ NÃ£o encontrado no Supabase';
                log('ğŸ¯ Quiz21StepsComplete nÃ£o encontrado no Supabase');

            } catch (error) {
                log(`âŒ Erro ao buscar quiz21: ${error.message}`);
            }
        }

        async function analyzeTableStructure() {
            log('ğŸ—ï¸ Analisando estrutura das tabelas...');
            const structureDiv = document.getElementById('structure-info');
            structureDiv.innerHTML = 'â³ Analisando estrutura...';

            try {
                // Simular anÃ¡lise de estrutura
                structureDiv.innerHTML = `ğŸ“Š AnÃ¡lise de Estrutura:
âŒ Tabela 'templates' nÃ£o encontrada
âŒ Tabela 'funnel_templates' nÃ£o encontrada
âŒ Tabela 'quiz_templates' nÃ£o encontrada

âœ… ConclusÃ£o: Nenhuma tabela de templates existe no Supabase
ğŸ“ Os templates estÃ£o sendo carregados apenas do cÃ³digo local`;

                log('ğŸ—ï¸ AnÃ¡lise de estrutura concluÃ­da');

            } catch (error) {
                log(`âŒ Erro na anÃ¡lise: ${error.message}`);
            }
        }

        async function checkPermissions() {
            log('ğŸ” Verificando permissÃµes...');
            // Simular verificaÃ§Ã£o de permissÃµes
            document.getElementById('structure-info').innerHTML += '\n\nğŸ” PermissÃµes: Limitadas (sem acesso Ã s tabelas)';
            log('ğŸ” PermissÃµes verificadas');
        }

        async function showCurrentConfig() {
            log('ğŸ”§ Mostrando configuraÃ§Ã£o atual...');
            const configDiv = document.getElementById('config-info');

            // Mostrar configuraÃ§Ã£o local conhecida
            configDiv.innerHTML = `ğŸ”§ ConfiguraÃ§Ã£o Atual:

ğŸ“ Fonte: src/config/templates/index.ts
ğŸ“Š Total de templates: ${window.AVAILABLE_TEMPLATES?.length || 'NÃ£o carregado'}
ğŸ¯ Quiz21StepsComplete: ${window.AVAILABLE_TEMPLATES?.find(t => t.id === 'quiz21StepsComplete') ? 'âœ… Encontrado' : 'âŒ NÃ£o encontrado'}

ğŸ—„ï¸ Supabase: NÃ£o sendo utilizado para templates
ğŸ“¦ LocalStorage: Para templates do usuÃ¡rio apenas
ğŸ’¾ Cache: Nenhum cache de templates ativo`;

            log('ğŸ”§ ConfiguraÃ§Ã£o atual carregada');
        }

        async function compareWithLocal() {
            log('âš–ï¸ Comparando com templates locais...');
            document.getElementById('config-info').innerHTML += `\n\nâš–ï¸ ComparaÃ§Ã£o:
âœ… Templates locais: Funcionando
âŒ Templates Supabase: NÃ£o existem
ğŸ“Š ConclusÃ£o: Sistema usa apenas templates locais`;
            log('âš–ï¸ ComparaÃ§Ã£o concluÃ­da');
        }

        function clearLogs() {
            detailedLog = 'ğŸ” Log de investigaÃ§Ã£o reiniciado...\n';
            document.getElementById('detailed-log').textContent = detailedLog;
        }

        function exportLogs() {
            const blob = new Blob([detailedLog], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `template-investigation-${new Date().toISOString().substring(0, 10)}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            log('ğŸ“„ Logs exportados');
        }

        // Expor funÃ§Ãµes globalmente
        window.checkSupabaseConnection = checkSupabaseConnection;
        window.checkTemplatesTables = checkTemplatesTables;
        window.fetchAllTemplates = fetchAllTemplates;
        window.searchQuiz21Template = searchQuiz21Template;
        window.analyzeTableStructure = analyzeTableStructure;
        window.checkPermissions = checkPermissions;
        window.showCurrentConfig = showCurrentConfig;
        window.compareWithLocal = compareWithLocal;
        window.clearLogs = clearLogs;
        window.exportLogs = exportLogs;

        // Auto-inicializar
        log('ğŸš€ Sistema de investigaÃ§Ã£o carregado');

        // Tentar carregar dados locais para referÃªncia
        try {
            log('ğŸ“ Tentando carregar referÃªncia dos templates locais...');
            // Esta informaÃ§Ã£o estaria disponÃ­vel se a pÃ¡gina fosse carregada no contexto da aplicaÃ§Ã£o
        } catch (error) {
            log('âš ï¸ Templates locais nÃ£o disponÃ­veis neste contexto');
        }

        // Atualizar resumo inicial
        document.getElementById('summary').innerHTML = `
        <strong>ğŸ¯ Objetivo:</strong> Verificar se existem templates no Supabase<br>
        <strong>ğŸ“Š Status:</strong> InvestigaÃ§Ã£o iniciada<br>
        <strong>ğŸ’¡ HipÃ³tese:</strong> Templates sÃ£o apenas locais, nÃ£o hÃ¡ dados no Supabase<br>
        <strong>ğŸ”§ PrÃ³ximos passos:</strong> Use os botÃµes acima para investigar cada aspecto
        `;
    </script>
</body>

</html>