<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/svg+xml" href="/vite.svg" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üöÄ Quiz Flow Pro Verso | Vista-se de Voc√™! - Gisele Galv√£o</title>
  <meta name="description" content="Descubra seu estilo pessoal √∫nico com nosso quiz interativo." />
  <!-- üõ°Ô∏è CSP: endurece execu√ß√£o bloqueando dom√≠nios Lovable em dev/preview.
    Ajuste conforme necess√°rio para adicionar novas origens confi√°veis. -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' https://fonts.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; connect-src 'self' https://*.supabase.co https://fonts.googleapis.com https://fonts.gstatic.com ws://localhost:* ws://127.0.0.1:* http://localhost:* http://127.0.0.1:*; img-src 'self' data: blob: https://res.cloudinary.com; frame-src 'self'; media-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; manifest-src 'self';" />
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#4F46E5">
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }

    #root {
      min-height: 100vh;
      width: 100%;
    }
  </style>
  <!-- üõ°Ô∏è EARLY LOVABLE BLOCKER (apenas fetch; n√£o intercepta XHR) -->
  <script>
    (function () {
      if (typeof window === 'undefined') return;
      const isInLovablePreview = window.self !== window.top;
      if (isInLovablePreview) return; // Permitir quando embutido (ex: preview oficial)

      const BLOCK_PATTERNS = ['lovable.dev', 'api.lovable.dev', 'lovableproject.com', '/_sandbox/'];
      const shouldBlock = (urlString) => BLOCK_PATTERNS.some(p => urlString.includes(p));

      // üîß FIX: Bloqueador mais robusto que intercepta TODOS os tipos de requisi√ß√£o
      const originalFetch = window.fetch;
      window.fetch = function (url, options) {
        let urlString = '';
        try {
          urlString = typeof url === 'string' ? url : url instanceof URL ? url.toString() : String(url);
          // üîß FIX: Detectar URLs mal formadas com project ID vazio (//collaborators)
          const hasMalformedUrl = urlString.includes('projects//') || urlString.includes('api.lovable.dev/projects//');

          if (shouldBlock(urlString) || hasMalformedUrl) {
            if (hasMalformedUrl) {
              console.warn('üõ°Ô∏è Bloqueada requisi√ß√£o Lovable mal formada (project ID ausente):', urlString);
            }
            return Promise.resolve(new Response(
              JSON.stringify({
                status: 'blocked',
                message: 'Lovable disabled in local dev',
                originalUrl: urlString
              }),
              { status: 200, headers: { 'Content-Type': 'application/json' } }
            ));
          }
        } catch (e) {
          console.warn('Erro ao processar URL no bloqueador:', e);
        }
        return originalFetch.call(this, url, options);
      };

      // üîß FIX: Interceptar XMLHttpRequest tamb√©m (para libs que n√£o usam fetch)
      if (typeof XMLHttpRequest !== 'undefined') {
        const originalOpen = XMLHttpRequest.prototype.open;
        XMLHttpRequest.prototype.open = function (method, url) {
          const urlString = String(url);
          const hasMalformedUrl = urlString.includes('projects//') || urlString.includes('api.lovable.dev/projects//');

          if (shouldBlock(urlString) || hasMalformedUrl) {
            console.warn('üõ°Ô∏è Bloqueada XHR Lovable:', urlString);
            // N√£o chama o open original - bloqueia completamente
            return;
          }
          return originalOpen.apply(this, arguments);
        };
      }
    })();
  </script>
</head>

<body>
  <div id="root"></div>
  <script src="/supabase-fallback-system.js" type="text/javascript"></script>
  <!-- üîß POLYFILLS ROBUSTOS: Garantir compatibilidade total -->
  <script>
    (function () {
      // 1. TypeScript __assign helper (usado por libs compiladas)
      if (typeof window.__assign !== 'function') {
        console.log('üîß Injetando polyfill __assign');
        window.__assign = Object.assign || function (target) {
          for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i];
            for (var key in source) {
              if (Object.prototype.hasOwnProperty.call(source, key)) {
                target[key] = source[key];
              }
            }
          }
          return target;
        };
      }

      // 2. TypeScript __rest helper  
      if (typeof window.__rest !== 'function') {
        window.__rest = function (source, excluded) {
          var target = {};
          for (var key in source) {
            if (Object.prototype.hasOwnProperty.call(source, key) && excluded.indexOf(key) < 0) {
              target[key] = source[key];
            }
          }
          return target;
        };
      }

      // 3. TypeScript __spreadArray helper
      if (typeof window.__spreadArray !== 'function') {
        window.__spreadArray = function (to, from, pack) {
          if (pack || arguments.length === 2) {
            for (var i = 0, l = from.length, ar; i < l; i++) {
              if (ar || !(i in from)) {
                if (!ar) ar = Array.prototype.slice.call(from, 0, i);
                ar[i] = from[i];
              }
            }
          }
          return to.concat(ar || Array.prototype.slice.call(from));
        };
      }

      // 4. Garantir que globalThis existe (para compatibility)
      if (typeof globalThis === 'undefined') {
        window.globalThis = window;
      }

      console.log('‚úÖ Polyfills TypeScript carregados com sucesso');
    })();
  </script>
  <script type="module" src="/src/main.tsx"></script>
</body>

</html>
