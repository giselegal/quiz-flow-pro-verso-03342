<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üöÄ Quiz Flow Pro Verso | Vista-se de Voc√™! - Gisele Galv√£o</title>

  <meta property="og:title" content="üöÄ Quiz Flow Pro Verso | Vista-se de Voc√™! - Gisele Galv√£o" />
  <meta property="og:description"
    content="Cansada do guarda-roupa lotado e nada combina? Fa√ßa o quiz da Gisele Galv√£o e descubra seu estilo com clareza e confian√ßa. Resultado imediato!" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://giselegalvao.com.br/" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Quiz Flow Pro Verso | Vista-se de Voc√™! - Gisele Galv√£o" />

  <!-- Permissions Policy para suprimir warnings -->
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()">

  <!-- Minimal head for maximum compatibility -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

  <!-- Essential font loading -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    .content-placeholder {
      width: 100%;
      max-width: 345px;
      aspect-ratio: 1.47;
      margin: 20px auto;
      background-color: #f6f3ef;
      border-radius: 0.5rem;
    }

    .js-loading {
      opacity: 0;
      transition: opacity 0.3s ease-in;
    }

    .will-animate {
      will-change: transform, opacity;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    #root {
      min-height: 100vh;
      width: 100%;
    }

    .loading-fallback {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background-color: #f9fafb;
    }

    .loading-spinner {
      width: 2.5rem;
      height: 2.5rem;
      border-radius: 50%;
      border: 2px solid #e5e7eb;
      border-top-color: #b29670;
      animation: spin 0.8s linear infinite;
      will-change: transform;
      transform: translateZ(0);
      backface-visibility: hidden;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .font-playfair {
      font-family: 'Playfair Display', serif;
    }
  </style>
</head>

<body>
  <div id="root">
    <div class="loading-fallback">
      <div class="loading-spinner"></div>
    </div>
  </div>

  <script type="module" src="/src/main.tsx"></script>

  <!-- üîÑ Chunk Recovery: Recarrega aplica√ß√£o ao detectar falha de carregamento de chunk (404 / network) -->
  <script>
    (function () {
      const MAX_RELOADS = 2;
      const FLAG_KEY = 'chunk-reload-attempts';
      function shouldRetry() {
        try {
          const v = parseInt(localStorage.getItem(FLAG_KEY) || '0', 10);
          if (v < MAX_RELOADS) {
            localStorage.setItem(FLAG_KEY, String(v + 1));
            return true;
          }
        } catch { }
        return false;
      }
      function clearFlag() {
        try { localStorage.removeItem(FLAG_KEY); } catch { }
      }
      window.addEventListener('load', clearFlag);
      window.addEventListener('error', function (ev) {
        // Detecta falhas em scripts din√¢micos (chunks)
        const target = ev.target || ev.srcElement;
        if (target && target.tagName === 'SCRIPT' && target.src && /assets\/.*\.js/.test(target.src)) {
          console.warn('[ChunkRecovery] Falha ao carregar chunk:', target.src);
          if (shouldRetry()) {
            const url = new URL(window.location.href);
            url.searchParams.set('_r', Date.now().toString());
            console.info('[ChunkRecovery] Recarregando p√°gina para tentar recuperar...');
            window.location.replace(url.toString());
          } else {
            console.error('[ChunkRecovery] Limite de tentativas atingido. Mostrar fallback.');
            // Opcional: exibir mensagem amig√°vel
            const el = document.createElement('div');
            el.style.cssText = 'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#fff;font-family:sans-serif;z-index:9999;padding:20px;text-align:center;color:#222;';
            el.innerHTML = '<div><h2 style="margin:0 0 12px;font-size:20px;">Atualizando recursos...</h2><p style="margin:0 0 8px;">N√£o conseguimos carregar alguns arquivos. Limpe o cache (CTRL+F5) ou tente novamente mais tarde.</p></div>';
            document.body.appendChild(el);
          }
        }
      }, true);
    })();
  </script>

  <script>
    // Unregister any existing service workers to avoid caching/fetch conflicts
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(regs => {
        for (const reg of regs) {
          reg.unregister().catch(() => { });
        }
      });
      if (typeof caches !== 'undefined') {
        caches
          .keys()
          .then(keys => keys.forEach(k => caches.delete(k)))
          .catch(() => { });
      }
    }
  </script>

  <!-- Supabase Fallback System (Deve carregar PRIMEIRO) -->
  <script src="/supabase-fallback-system.js" type="text/javascript"></script>

  <!-- Canvas-Preview Sync Test -->
  <script type="text/javascript">
    // Embed do script diretamente para evitar problemas de MIME type
    /**
     * üß™ TESTE PR√ÅTICO CANVAS-PREVIEW SYNCHRONIZATION
     * Execute no console do navegador para testar sincroniza√ß√£o real
     */

    window.testCanvasPreviewSync = async () => {
      console.log('üöÄ Iniciando teste pr√°tico de sincroniza√ß√£o Canvas ‚Üî Preview...');

      const results = {
        tests: [],
        passed: 0,
        failed: 0,
        total: 0
      };

      const addResult = (name, success, message = '') => {
        results.tests.push({ name, success, message });
        results.total++;
        if (success) {
          results.passed++;
          console.log(`‚úÖ ${name}: OK`);
        } else {
          results.failed++;
          console.log(`‚ùå ${name}: ${message}`);
        }
      };

      try {
        // Teste 1: Verificar fallback system
        addResult(
          'Sistema de Fallback Ativo',
          !!window.supabaseFallback,
          window.supabaseFallback ? 'Sistema carregado' : 'Sistema n√£o encontrado'
        );

        // Teste 2: Verificar canvas
        const canvasContainer = document.querySelector('.canvas-container, [data-canvas], .editor-canvas, .quiz-editor');
        addResult(
          'Canvas Container Encontrado',
          !!canvasContainer,
          canvasContainer ? 'Canvas encontrado' : 'Canvas n√£o encontrado'
        );

        // Teste 3: Verificar preview
        const previewContainer = document.querySelector('.preview-container, [data-preview], .quiz-preview, .preview-area');
        addResult(
          'Preview Container Encontrado',
          !!previewContainer,
          previewContainer ? 'Preview encontrado' : 'Preview n√£o encontrado'
        );

        // Teste 4: Verificar etapas
        const steps = document.querySelectorAll('[data-step], .step, .quiz-step, [data-canvas-step], [data-preview-step]');
        addResult(
          'Etapas Detectadas',
          steps.length > 0,
          `${steps.length} etapas encontradas`
        );

        // Teste 5: Testar configura√ß√µes locais
        if (window.supabaseFallback) {
          const config = window.supabaseFallback.getConfig('quiz-global-config');
          addResult(
            'Configura√ß√£o Local Funcional',
            !!config && !!config.theme,
            config ? 'Configura√ß√£o carregada' : 'Falha ao carregar configura√ß√£o'
          );
        }

        // Teste 6: Verificar localStorage sync
        const hasLocalData = Object.keys(localStorage).some(key =>
          key.includes('canvas') || key.includes('quiz') || key.includes('config')
        );
        addResult(
          'Dados Locais Dispon√≠veis',
          hasLocalData,
          hasLocalData ? 'LocalStorage com dados' : 'Sem dados locais'
        );

      } catch (error) {
        console.error('Erro durante testes:', error);
        addResult('Erro Global', false, error.message);
      }

      console.log('\nüìä RELAT√ìRIO FINAL - Teste Canvas ‚Üî Preview');
      console.log('='.repeat(50));
      console.log(`‚úÖ Passou: ${results.passed}/${results.total}`);
      console.log(`‚ùå Falhou: ${results.failed}/${results.total}`);
      console.log(`üìà Taxa: ${((results.passed / results.total) * 100).toFixed(1)}%`);

      results.tests.forEach((test, i) => {
        const icon = test.success ? '‚úÖ' : '‚ùå';
        console.log(`${i + 1}. ${icon} ${test.name} ${test.message ? `- ${test.message}` : ''}`);
      });

      return results;
    };

    window.startSyncDiagnostic = () => {
      console.log('üîÑ Iniciando diagn√≥stico cont√≠nuo...');
      let issues = 0;

      const check = () => {
        const canvas = document.querySelectorAll('[data-canvas], .canvas-container');
        const preview = document.querySelectorAll('[data-preview], .preview-container');

        if (canvas.length !== preview.length && issues++ < 5) {
          console.warn(`‚ö†Ô∏è Dessincroniza√ß√£o: Canvas ${canvas.length} vs Preview ${preview.length}`);
        }
      };

      const interval = setInterval(check, 2000);
      console.log('‚úÖ Diagn√≥stico iniciado. Use stopSyncDiagnostic() para parar.');

      window.stopSyncDiagnostic = () => {
        clearInterval(interval);
        console.log('üõë Diagn√≥stico parado.');
      };

      return interval;
    };

    // Auto-executar quando pronto
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        console.log('üîç Sistema de Teste Canvas-Preview pronto!');
        console.log('üíª Execute: testCanvasPreviewSync()');
        console.log('üîÑ Execute: startSyncDiagnostic()');

        // Auto-teste se sistema de fallback estiver ativo
        if (window.supabaseFallback) {
          console.log('üöÄ Auto-executando teste devido ao sistema de fallback...');
          setTimeout(window.testCanvasPreviewSync, 1000);
        }
      }, 500);
    });
  </script>

  <!-- Cloudinary Upload Widget -->
  <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>
</body>

</html>