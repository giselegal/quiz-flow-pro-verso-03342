#!/bin/bash
##############################################################################
# Script Simplificado - Aplicar Migrations via Dashboard
# 
# Este script prepara os comandos SQL em um formato fÃ¡cil de copiar e colar
# no SQL Editor do Supabase Dashboard
##############################################################################

echo "ğŸ”’ APLICAÃ‡ÃƒO DE MIGRATIONS DE SEGURANÃ‡A"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "âš ï¸  A aplicaÃ§Ã£o via API requer service_role key completa."
echo "    A chave atual (.env) pode nÃ£o ter permissÃµes suficientes."
echo ""
echo "ğŸ“– APLICAÃ‡ÃƒO MANUAL (RECOMENDADO):"
echo ""
echo "   1. Acesse o Dashboard:"
echo "      https://pwtjuuhchtbzttrzoutw.supabase.co"
echo ""
echo "   2. VÃ¡ para: SQL Editor (menu lateral)"
echo ""
echo "   3. Clique em 'New Query'"
echo ""
echo "   4. PRIMEIRA MIGRATION - Cole e execute:"
echo "      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "      â”‚ Arquivo: supabase/migrations/             â”‚"
echo "      â”‚          20251110_auth_hardening_rls.sql  â”‚"
echo "      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
read -p "      Pressione ENTER para ver o conteÃºdo... "
echo ""
cat supabase/migrations/20251110_auth_hardening_rls.sql | head -50
echo ""
echo "      ... (arquivo completo tem $(wc -l < supabase/migrations/20251110_auth_hardening_rls.sql) linhas)"
echo ""
echo "   5. SEGUNDA MIGRATION - Cole e execute:"
echo "      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "      â”‚ Arquivo: supabase/migrations/             â”‚"
echo "      â”‚          20251128_security_enhancements.sqlâ”‚"
echo "      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
read -p "      Pressione ENTER para ver o conteÃºdo... "
echo ""
cat supabase/migrations/20251128_security_enhancements.sql | head -50
echo ""
echo "      ... (arquivo completo tem $(wc -l < supabase/migrations/20251128_security_enhancements.sql) linhas)"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ¨ ATALHO RÃPIDO:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "   Copie os arquivos para a Ã¡rea de transferÃªncia:"
echo ""
echo "   # Migration 1 (RLS Policies):"
echo "   cat supabase/migrations/20251110_auth_hardening_rls.sql | pbcopy"
echo "   # ou no Linux:"
echo "   cat supabase/migrations/20251110_auth_hardening_rls.sql | xclip -selection clipboard"
echo ""
echo "   # Migration 2 (Security Enhancements):"
echo "   cat supabase/migrations/20251128_security_enhancements.sql | pbcopy"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "ğŸ” VALIDAÃ‡ÃƒO PÃ“S-APLICAÃ‡ÃƒO:"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "   ApÃ³s executar as migrations no Dashboard, valide:"
echo ""
echo "   node scripts/validate-security.mjs"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
