<!DOCTYPE html>
<html>

<head>
    <title>Debug Editor Loading</title>
    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: white;
            border-left: 4px solid #ddd;
        }

        .status.success {
            border-color: #22c55e;
        }

        .status.error {
            border-color: #ef4444;
            background: #fee;
        }

        .status.warning {
            border-color: #f59e0b;
            background: #fffbeb;
        }

        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }

        .btn {
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }

        .btn:hover {
            background: #2563eb;
        }
    </style>
</head>

<body>
    <h1>üîç Diagn√≥stico do Editor</h1>

    <div id="results"></div>

    <button class="btn" onclick="runTests()">‚ñ∂Ô∏è Executar Testes</button>
    <button class="btn" onclick="location.reload()">üîÑ Recarregar</button>
    <button class="btn" onclick="window.open('/editor', '_blank')">üöÄ Abrir Editor</button>

    <script>
        const results = document.getElementById('results');

        function addStatus(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function addCode(title, code) {
            const div = document.createElement('div');
            div.innerHTML = `<h3>${title}</h3><pre>${code}</pre>`;
            results.appendChild(div);
        }

        async function runTests() {
            results.innerHTML = '<h2>üß™ Executando Testes...</h2>';

            // Test 1: Verificar servidor
            try {
                const res = await fetch('/');
                if (res.ok) {
                    addStatus('‚úÖ Servidor respondendo', 'success');
                } else {
                    addStatus('‚ö†Ô∏è Servidor respondeu com status: ' + res.status, 'warning');
                }
            } catch (e) {
                addStatus('‚ùå Erro ao conectar com servidor: ' + e.message, 'error');
            }

            // Test 2: Verificar rota do editor
            try {
                const res = await fetch('/editor');
                if (res.ok) {
                    addStatus('‚úÖ Rota /editor acess√≠vel', 'success');
                    const html = await res.text();

                    // Verificar se h√° scripts
                    const scriptMatches = html.match(/<script[^>]*src=["']([^"']+)["']/gi);
                    if (scriptMatches && scriptMatches.length > 0) {
                        addStatus(`‚úÖ ${scriptMatches.length} scripts encontrados`, 'success');
                    } else {
                        addStatus('‚ö†Ô∏è Nenhum script encontrado no HTML', 'warning');
                    }
                } else {
                    addStatus('‚ùå Erro ao acessar /editor: ' + res.status, 'error');
                }
            } catch (e) {
                addStatus('‚ùå Erro ao acessar /editor: ' + e.message, 'error');
            }

            // Test 3: Verificar m√≥dulos Vite
            try {
                const res = await fetch('/@vite/client');
                if (res.ok) {
                    addStatus('‚úÖ Vite client carregado', 'success');
                } else {
                    addStatus('‚ö†Ô∏è Vite client n√£o encontrado', 'warning');
                }
            } catch (e) {
                addStatus('‚ùå Erro ao carregar Vite client: ' + e.message, 'error');
            }

            // Test 4: Verificar console errors
            const errors = [];
            const originalError = console.error;
            console.error = function (...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };

            // Test 5: Tentar importar React
            try {
                const module = await import('react');
                addStatus('‚úÖ React carregado com sucesso', 'success');
            } catch (e) {
                addStatus('‚ùå Erro ao importar React: ' + e.message, 'error');
            }

            // Test 6: Tentar importar o componente do editor
            try {
                addStatus('üîÑ Tentando carregar QuizModularProductionEditor...', 'warning');
                const module = await import('/src/components/editor/quiz/QuizModularProductionEditor.tsx');
                addStatus('‚úÖ QuizModularProductionEditor carregado', 'success');
            } catch (e) {
                addStatus('‚ùå Erro ao importar editor: ' + e.message, 'error');
                addCode('Stack Trace:', e.stack || 'N/A');
            }

            // Test 7: Verificar localStorage
            try {
                localStorage.setItem('test', 'ok');
                localStorage.removeItem('test');
                addStatus('‚úÖ LocalStorage funcionando', 'success');
            } catch (e) {
                addStatus('‚ùå Erro no localStorage: ' + e.message, 'error');
            }

            // Test 8: Verificar se h√° erros acumulados
            if (errors.length > 0) {
                addStatus('‚ö†Ô∏è Erros no console:', 'warning');
                addCode('Console Errors:', errors.join('\n'));
            }

            addStatus('‚úÖ Testes conclu√≠dos!', 'success');
        }

        // Auto-run on load
        window.addEventListener('load', () => {
            setTimeout(runTests, 500);
        });
    </script>
</body>

</html>