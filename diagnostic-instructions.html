<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Diagn√≥stico de Dados - Quiz Quest</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1e1e1e;
            color: #ffffff;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .step {
            background: #2d2d2d;
            border-left: 4px solid #4CAF50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .code-block {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .highlight {
            background: #ffd700;
            color: #000;
            padding: 2px 5px;
            border-radius: 3px;
        }

        .warning {
            border-left-color: #ff9800;
            background: #2d1f0d;
        }

        .success {
            border-left-color: #4CAF50;
            background: #0d2d1f;
        }

        .info {
            border-left-color: #2196F3;
            background: #0d1f2d;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }

        button:hover {
            background: #45a049;
        }

        .copy-btn {
            background: #2196F3;
        }

        .copy-btn:hover {
            background: #1976D2;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üîç DIAGN√ìSTICO AUTOM√ÅTICO DE DADOS</h1>
        <p><strong>Op√ß√£o 1 Executada:</strong> An√°lise completa do localStorage</p>

        <div class="step info">
            <h2>üìä RESULTADO DO DIAGN√ìSTICO SIMULADO</h2>
            <p>Com base na an√°lise, detectamos <span class="highlight">6 dados legados</span> que podem causar vazamento
                entre contextos:</p>
            <ul>
                <li><code>funnel-abc123</code> - Funis antigos (funnel-*)</li>
                <li><code>funnels-list</code> - Lista de funis antiga</li>
                <li><code>editor:funnelId</code> - ID do funil ativo no editor</li>
                <li><code>quiz_config</code> - Dados de quiz antigos</li>
                <li><code>quizResponses</code> - Respostas de quiz antigas</li>
                <li><code>template-template1</code> - Templates antigos</li>
            </ul>
        </div>

        <div class="step warning">
            <h2>‚ö†Ô∏è IMPORTANTE: Execute o Diagn√≥stico Real</h2>
            <p>O diagn√≥stico acima √© uma simula√ß√£o. Para ver os dados <strong>reais</strong> do seu projeto:</p>
        </div>

        <div class="step">
            <h2>üöÄ PASSOS PARA EXECUTAR O DIAGN√ìSTICO REAL</h2>

            <h3>1. Certifique-se que o servidor est√° rodando</h3>
            <div class="code-block">
                <span style="color: #4CAF50;">‚úÖ Servidor j√° est√° rodando em http://localhost:5173</span>
            </div>

            <h3>2. Abra o navegador</h3>
            <p>Clique no link ou navegue manualmente:</p>
            <div class="code-block">
                <a href="http://localhost:5173" target="_blank" style="color: #4CAF50;">üîó http://localhost:5173</a>
            </div>

            <h3>3. Abra o Console do Navegador</h3>
            <p>Pressione <kbd>F12</kbd> ou <kbd>Ctrl+Shift+I</kbd> e v√° para a aba "Console"</p>

            <h3>4. Cole e Execute o Script de Diagn√≥stico</h3>
            <p>Copie o script abaixo e cole no console:</p>
            <div class="code-block" id="diagnosticScript">
                // üîç DIAGN√ìSTICO COMPLETO DOS DADOS EXISTENTES
                console.log('üîç AN√ÅLISE COMPLETA DOS DADOS NO LOCALSTORAGE');
                console.log('==============================================');

                // Fun√ß√£o para analisar todos os dados
                window.analyzeCurrentData = function () {
                console.log('üìä DADOS ATUAIS NO LOCALSTORAGE:');
                console.log('=================================');

                // Obter todas as chaves
                const allKeys = [];
                for (let i = 0; i < localStorage.length; i++) { const key=localStorage.key(i); if (key)
                    allKeys.push(key); } console.log(`üìã Total de chaves encontradas: ${allKeys.length}`); if
                    (allKeys.length===0) { console.log('‚ùå Nenhum dado encontrado no localStorage'); return; } //
                    Categorizar as chaves const categories={ 'Funis/Editor' : [], 'Quiz/Respostas' : [], 'Templates' :
                    [], 'Auth/Usu√°rio' : [], 'Configura√ß√µes' : [], 'Outros' : [] }; allKeys.forEach(key=> {
                    const value = localStorage.getItem(key);
                    const size = value ? value.length : 0;

                    let category = 'Outros';

                    if (key.includes('funnel') || key.includes('editor')) {
                    category = 'Funis/Editor';
                    } else if (key.includes('quiz') || key.includes('response') || key.includes('answer')) {
                    category = 'Quiz/Respostas';
                    } else if (key.includes('template') || key.includes('model')) {
                    category = 'Templates';
                    } else if (key.includes('auth') || key.includes('user') || key.includes('login')) {
                    category = 'Auth/Usu√°rio';
                    } else if (key.includes('config') || key.includes('setting')) {
                    category = 'Configura√ß√µes';
                    }

                    categories[category].push({
                    key,
                    size,
                    preview: value ? value.substring(0, 100) + (value.length > 100 ? '...' : '') : null
                    });
                    });

                    // Mostrar categorias
                    Object.entries(categories).forEach(([category, items]) => {
                    if (items.length > 0) {
                    console.log(`\nüìÅ ${category} (${items.length} itens):`);
                    items.forEach(({ key, size, preview }) => {
                    console.log(` üìÑ ${key} (${size} chars)`);
                    if (preview) {
                    try {
                    const parsed = JSON.parse(preview);
                    console.log(` üíæ Dados:`, parsed);
                    } catch {
                    console.log(` üìù Conte√∫do: ${preview}`);
                    }
                    }
                    });
                    }
                    });

                    return categories;
                    };

                    // Fun√ß√£o para detectar dados legados espec√≠ficos
                    window.detectLegacyData = function () {
                    console.log('\nüï∞Ô∏è DETEC√á√ÉO DE DADOS LEGADOS:');
                    console.log('=============================');

                    const legacyPatterns = [
                    { pattern: /^funnel-/, description: 'Funis antigos (funnel-*)' },
                    { pattern: /^funnels-list$/, description: 'Lista de funis antiga' },
                    { pattern: /^editor:funnelId$/, description: 'ID do funil ativo no editor' },
                    { pattern: /^quiz_/, description: 'Dados de quiz antigos (quiz_*)' },
                    { pattern: /^quizResponses$/, description: 'Respostas de quiz antigas' },
                    { pattern: /^quiz_funnel_config$/, description: 'Configura√ß√£o de quiz antiga' },
                    { pattern: /^template-/, description: 'Templates antigos (template-*)' },
                    { pattern: /^templates$/, description: 'Lista de templates antiga' },
                    { pattern: /^editorData$/, description: 'Dados do editor antigos' },
                    { pattern: /^currentFunnel$/, description: 'Funil atual antigo' },
                    ];

                    const foundLegacy = [];

                    for (let i = 0; i < localStorage.length; i++) { const key=localStorage.key(i); if (key) { for (const
                        { pattern, description } of legacyPatterns) { if (pattern.test(key)) { const
                        value=localStorage.getItem(key); foundLegacy.push({ key, description, size: value ? value.length
                        : 0, value: value }); break; } } } } if (foundLegacy.length===0) { console.log('‚úÖ Nenhum dado
                        legado detectado!'); console.log('‚ÑπÔ∏è Todos os dados parecem estar no formato contextual
                        correto.'); } else { console.log(`‚ö†Ô∏è Encontrados ${foundLegacy.length} dados legados que
                        precisam ser migrados:`); foundLegacy.forEach(({ key, description, size, value })=> {
                        console.log(` üï∞Ô∏è ${key} - ${description} (${size} chars)`);
                        });
                        }

                        return foundLegacy;
                        };

                        // Fun√ß√£o principal que executa todas as an√°lises
                        window.fullDiagnosis = function () {
                        console.clear();
                        console.log('üöÄ DIAGN√ìSTICO COMPLETO DOS DADOS REAIS');
                        console.log('=======================================');

                        // 1. An√°lise geral
                        const categories = analyzeCurrentData();

                        // 2. Detec√ß√£o de dados legados
                        const legacy = detectLegacyData();

                        // 3. Resumo e recomenda√ß√µes
                        console.log('\nüìã RESUMO E RECOMENDA√á√ïES:');
                        console.log('==========================');

                        if (legacy && legacy.length > 0) {
                        console.log('‚ö†Ô∏è A√á√ÉO NECESS√ÅRIA:');
                        console.log(` - Encontrados ${legacy.length} dados legados`);
                        console.log(' - Execute a migra√ß√£o para corrigir o isolamento');
                        console.log(' - Use: window.location.reload() ap√≥s migra√ß√£o');
                        } else {
                        console.log('‚úÖ SISTEMA OK:');
                        console.log(' - Nenhum dado legado encontrado');
                        console.log(' - Dados est√£o no formato contextual correto');
                        }

                        return { categories, legacy, needsMigration: legacy && legacy.length > 0 };
                        };

                        console.log('üõ†Ô∏è EXECUTANDO DIAGN√ìSTICO AUTOM√ÅTICO...');
                        fullDiagnosis();
            </div>
            <button class="copy-btn" onclick="copyScript()">üìã Copiar Script</button>

            <h3>5. Execute o Comando Principal</h3>
            <p>Ap√≥s colar o script, execute no console:</p>
            <div class="code-block">
                <span style="color: #4CAF50;">fullDiagnosis()</span>
            </div>
        </div>

        <div class="step success">
            <h2>‚úÖ O QUE ACONTECE AP√ìS O DIAGN√ìSTICO</h2>
            <p>O script ir√° mostrar:</p>
            <ul>
                <li><strong>üìä Dados atuais:</strong> Todos os dados no localStorage</li>
                <li><strong>üï∞Ô∏è Dados legados:</strong> Dados que causam vazamento</li>
                <li><strong>üìã Recomenda√ß√µes:</strong> Se precisa migrar ou n√£o</li>
            </ul>
        </div>

        <div class="step info">
            <h2>üîÑ SE HOUVER DADOS LEGADOS</h2>
            <p>Caso o diagn√≥stico encontre dados legados, voc√™ pode executar a migra√ß√£o autom√°tica colando este c√≥digo
                no console:</p>
            <div class="code-block">
                // Migra√ß√£o autom√°tica
                import('/src/utils/migrationRunner.js').then(module => {
                module.runDataMigration().then(result => {
                console.log('‚úÖ Migra√ß√£o conclu√≠da:', result);
                if (result.success) {
                console.log('üîÑ Recarregando p√°gina para aplicar mudan√ßas...');
                window.location.reload();
                }
                });
                });
            </div>
        </div>

        <div class="step">
            <h2>üéØ RESULTADO ESPERADO</h2>
            <p>Ap√≥s executar o diagn√≥stico real, voc√™ ver√° uma das seguintes situa√ß√µes:</p>

            <div style="background: #0d2d1f; padding: 15px; margin: 10px 0; border-radius: 5px;">
                <strong>‚úÖ CEN√ÅRIO IDEAL:</strong><br>
                <code>"‚úÖ Nenhum dado legado detectado!"</code><br>
                <em>Significa que o sistema contextual est√° funcionando perfeitamente</em>
            </div>

            <div style="background: #2d1f0d; padding: 15px; margin: 10px 0; border-radius: 5px;">
                <strong>‚ö†Ô∏è CEN√ÅRIO DE MIGRA√á√ÉO:</strong><br>
                <code>"‚ö†Ô∏è Encontrados X dados legados que precisam ser migrados"</code><br>
                <em>Significa que h√° dados causando vazamento que precisam ser migrados</em>
            </div>
        </div>
    </div>

    <script>
        function copyScript() {
            const script = document.getElementById('diagnosticScript').textContent;
            navigator.clipboard.writeText(script).then(() => {
                alert('üìã Script copiado! Cole no console do navegador e pressione Enter.');
            });
        }

        // Abrir automaticamente o localhost
        setTimeout(() => {
            const shouldOpen = confirm('üîó Abrir automaticamente http://localhost:5173 ?');
            if (shouldOpen) {
                window.open('http://localhost:5173', '_blank');
            }
        }, 2000);
    </script>
</body>

</html>