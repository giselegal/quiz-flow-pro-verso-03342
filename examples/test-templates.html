<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üß™ Teste de Templates - Quiz Etapas</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-container {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }
      .step-info {
        border-left: 4px solid #3b82f6;
        padding-left: 16px;
        margin: 10px 0;
        background: #f8fafc;
      }
      .block-item {
        background: #e0f2fe;
        border: 1px solid #0284c7;
        border-radius: 4px;
        padding: 8px 12px;
        margin: 4px 0;
        font-size: 14px;
      }
      .error {
        color: #dc2626;
        background: #fef2f2;
        border: 1px solid #fca5a5;
        padding: 12px;
        border-radius: 4px;
        margin: 8px 0;
      }
      .success {
        color: #059669;
        background: #ecfdf5;
        border: 1px solid #6ee7b7;
        padding: 12px;
        border-radius: 4px;
        margin: 8px 0;
      }
      .log {
        background: #f3f4f6;
        padding: 8px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Teste de Sistema de Templates - Quiz 21 Etapas</h1>

    <div class="test-container">
      <h2>üìä Status dos Templates</h2>
      <div id="template-status">Carregando...</div>
    </div>

    <div class="test-container">
      <h2>üîç Teste Detalhado por Etapa</h2>
      <div id="step-tests">Carregando...</div>
    </div>

    <div class="test-container">
      <h2>üìã Logs de Debug</h2>
      <div id="debug-logs" class="log">Aguardando logs...</div>
    </div>

    <script type="module">
      console.log('üöÄ Iniciando teste de templates...');

      // Mock das funcionalidades que seriam importadas
      const mockStepTemplateService = {
        async getStepTemplate(stepNumber) {
          console.log(`üìä Mock: Obtendo template da etapa ${stepNumber}`);

          // Simular templates b√°sicos para teste
          const basicTemplates = {
            1: [
              {
                type: 'quiz-intro-header',
                properties: { title: 'Introdu√ß√£o' },
              },
              {
                type: 'text-inline',
                properties: { content: 'Bem-vindo ao quiz!' },
              },
              { type: 'button-inline', properties: { text: 'Come√ßar' } },
            ],
            2: [
              {
                type: 'heading-inline',
                properties: { text: 'Como podemos te chamar?' },
              },
              { type: 'form-input', properties: { label: 'Seu nome' } },
              { type: 'button-inline', properties: { text: 'Continuar' } },
            ],
            3: [
              {
                type: 'quiz-progress',
                properties: { currentStep: 3, totalSteps: 21 },
              },
              {
                type: 'quiz-question',
                properties: { title: 'QUAL O SEU TIPO DE ROUPA FAVORITA?' },
              },
              { type: 'options-grid', properties: { layout: 'grid' } },
            ],
          };

          return basicTemplates[stepNumber] || [];
        },

        async getAllSteps() {
          const steps = [];
          for (let i = 1; i <= 21; i++) {
            const template = await this.getStepTemplate(i);
            steps.push({
              id: `etapa-${i}`,
              name: `Etapa ${i}`,
              order: i,
              type:
                i === 1
                  ? 'intro'
                  : i === 2
                    ? 'intro'
                    : i <= 13
                      ? 'question'
                      : i <= 19
                        ? 'strategic'
                        : i === 20
                          ? 'result'
                          : 'offer',
              description: `Descri√ß√£o da etapa ${i}`,
              blocksCount: template.length,
              hasTemplate: template.length > 0,
            });
          }
          return steps;
        },
      };

      async function testTemplateSystem() {
        const statusDiv = document.getElementById('template-status');
        const stepsDiv = document.getElementById('step-tests');
        const logsDiv = document.getElementById('debug-logs');

        let logs = '';
        function addLog(message) {
          logs += new Date().toLocaleTimeString() + ' - ' + message + '\n';
          logsDiv.textContent = logs;
          console.log(message);
        }

        try {
          addLog('üîç Testando sistema de templates...');

          // Teste 1: Verificar se consegue obter todas as etapas
          const allSteps = await mockStepTemplateService.getAllSteps();
          addLog(`‚úÖ Obtidas ${allSteps.length} etapas`);

          let statusHtml = `<div class="success">‚úÖ Sistema b√°sico funcionando: ${allSteps.length} etapas encontradas</div>`;

          // Teste 2: Verificar etapas espec√≠ficas
          const stepsWithTemplates = allSteps.filter(step => step.hasTemplate);
          const stepsWithoutTemplates = allSteps.filter(step => !step.hasTemplate);

          statusHtml += `<div class="step-info">
                    <strong>Etapas com template:</strong> ${stepsWithTemplates.length}<br>
                    <strong>Etapas sem template:</strong> ${stepsWithoutTemplates.length}
                </div>`;

          if (stepsWithoutTemplates.length > 0) {
            statusHtml += `<div class="error">‚ö†Ô∏è Etapas sem template: ${stepsWithoutTemplates.map(s => s.name).join(', ')}</div>`;
          }

          statusDiv.innerHTML = statusHtml;

          // Teste 3: Testar cada etapa individual
          let stepsHtml = '';
          for (let i = 1; i <= 5; i++) {
            // Testar apenas as primeiras 5 para n√£o sobrecarregar
            const template = await mockStepTemplateService.getStepTemplate(i);
            addLog(`üìä Etapa ${i}: ${template.length} blocos`);

            stepsHtml += `<div class="step-info">
                        <h3>Etapa ${i}</h3>
                        <p><strong>Blocos:</strong> ${template.length}</p>`;

            if (template.length > 0) {
              stepsHtml += '<div>Tipos de blocos:<br>';
              template.forEach(block => {
                stepsHtml += `<div class="block-item">${block.type}</div>`;
              });
              stepsHtml += '</div>';
            } else {
              stepsHtml += '<div class="error">‚ùå Nenhum bloco encontrado</div>';
            }

            stepsHtml += '</div>';
          }

          stepsDiv.innerHTML = stepsHtml;
          addLog('‚úÖ Teste conclu√≠do com sucesso!');
        } catch (error) {
          addLog(`‚ùå Erro durante teste: ${error.message}`);
          statusDiv.innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
        }
      }

      // Executar teste
      testTemplateSystem();

      // Adicionar bot√£o para testar novamente
      const retestButton = document.createElement('button');
      retestButton.textContent = 'üîÑ Testar Novamente';
      retestButton.style.cssText =
        'padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 10px 0;';
      retestButton.onclick = () => {
        document.getElementById('debug-logs').textContent = 'Aguardando logs...';
        testTemplateSystem();
      };
      document.body.appendChild(retestButton);
    </script>
  </body>
</html>
