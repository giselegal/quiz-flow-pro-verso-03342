<!DOCTYPE html>
<html>
<head>
    <title>ğŸ”¬ DiagnÃ³stico do Sistema</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .status { padding: 10px; margin: 5px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        .code { background: #f8f9fa; padding: 10px; margin: 10px 0; border: 1px solid #ddd; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ DiagnÃ³stico do Sistema Quiz Quest</h1>
    <p>Status atual do sistema - Verificando problemas de renderizaÃ§Ã£o</p>
    
    <div id="results"></div>
    
    <h2>ğŸ§ª Testes DisponÃ­veis</h2>
    <button onclick="testTemplateLoad()">ğŸ”„ Teste Template Load</button>
    <button onclick="testComponentRegistry()">ğŸ“¦ Teste Component Registry</button>
    <button onclick="testRouting()">ğŸ›£ï¸ Teste Routing</button>
    <button onclick="testContexts()">ğŸ”— Teste Contexts</button>
    <button onclick="runFullDiagnostic()">ğŸ¥ DiagnÃ³stico Completo</button>
    
    <script>
        const results = document.getElementById('results');
        
        function addResult(type, message) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function testTemplateLoad() {
            addResult('info', 'ğŸ”„ Testando carregamento de templates...');
            
            try {
                // Teste 1: Verificar se o template existe
                const response = await fetch('/src/templates/quiz21StepsComplete.ts');
                if (response.ok) {
                    addResult('success', 'âœ… Template quiz21StepsComplete.ts encontrado');
                } else {
                    addResult('error', 'âŒ Template quiz21StepsComplete.ts nÃ£o encontrado');
                }
                
                // Teste 2: Verificar se o JSON master existe
                const jsonResponse = await fetch('/templates/quiz21-complete.json');
                if (jsonResponse.ok) {
                    addResult('success', 'âœ… Master JSON quiz21-complete.json encontrado');
                    const jsonData = await jsonResponse.json();
                    addResult('info', `ğŸ“Š Master JSON tem ${Object.keys(jsonData.steps || {}).length} etapas`);
                } else {
                    addResult('warning', 'âš ï¸ Master JSON quiz21-complete.json nÃ£o encontrado (fallback disponÃ­vel)');
                }
                
                // Teste 3: Verificar template no localStorage
                const cached = localStorage.getItem('funnel-template-cache');
                if (cached) {
                    addResult('success', 'âœ… Cache local de templates disponÃ­vel');
                } else {
                    addResult('info', 'â„¹ï¸ Nenhum cache local de templates (normal na primeira execuÃ§Ã£o)');
                }
                
            } catch (error) {
                addResult('error', `âŒ Erro no teste de templates: ${error.message}`);
            }
        }
        
        async function testComponentRegistry() {
            addResult('info', 'ğŸ”„ Testando registro de componentes...');
            
            try {
                // Componentes essenciais que devem existir
                const essentialComponents = [
                    'quiz-intro-header',
                    'options-grid',
                    'text-inline',
                    'button-inline'
                ];
                
                // Simular checagem de componentes no window
                if (typeof window !== 'undefined') {
                    addResult('success', 'âœ… Window object disponÃ­vel');
                    
                    // Verificar se React estÃ¡ carregado
                    if (window.React) {
                        addResult('success', 'âœ… React carregado');
                    } else {
                        addResult('warning', 'âš ï¸ React nÃ£o detectado no window (normal em build production)');
                    }
                }
                
                addResult('info', `ğŸ“¦ Componentes essenciais requeridos: ${essentialComponents.join(', ')}`);
                
            } catch (error) {
                addResult('error', `âŒ Erro no teste de componentes: ${error.message}`);
            }
        }
        
        async function testRouting() {
            addResult('info', 'ğŸ”„ Testando sistema de rotas...');
            
            const routes = [
                '/',
                '/editor',
                '/modular-editor',
                '/comparativo'
            ];
            
            for (const route of routes) {
                try {
                    const response = await fetch(route, { method: 'HEAD' });
                    if (response.ok) {
                        addResult('success', `âœ… Rota ${route} acessÃ­vel`);
                    } else {
                        addResult('error', `âŒ Rota ${route} retornou ${response.status}`);
                    }
                } catch (error) {
                    addResult('error', `âŒ Erro na rota ${route}: ${error.message}`);
                }
            }
        }
        
        async function testContexts() {
            addResult('info', 'ğŸ”„ Testando contexts e providers...');
            
            try {
                // Verificar se hÃ¡ erros no console
                const errorCount = performance.getEntriesByType('navigation').length;
                addResult('info', `ğŸ“Š NavegaÃ§Ãµes registradas: ${errorCount}`);
                
                // Verificar local storage para contextos salvos
                const funnelsData = localStorage.getItem('funnels-context');
                if (funnelsData) {
                    addResult('success', 'âœ… FunnelsContext tem dados salvos');
                } else {
                    addResult('info', 'â„¹ï¸ FunnelsContext sem dados salvos (normal em primeira execuÃ§Ã£o)');
                }
                
                // Verificar se hÃ¡ providers ativos
                const providers = ['FunnelsProvider', 'PureBuilderProvider', 'AuthProvider'];
                addResult('info', `ğŸ”— Providers necessÃ¡rios: ${providers.join(', ')}`);
                
            } catch (error) {
                addResult('error', `âŒ Erro no teste de contexts: ${error.message}`);
            }
        }
        
        async function runFullDiagnostic() {
            clearResults();
            addResult('info', 'ğŸ¥ Iniciando diagnÃ³stico completo...');
            
            await testTemplateLoad();
            await testComponentRegistry(); 
            await testRouting();
            await testContexts();
            
            // Teste final: verificar se hÃ¡ erros JavaScript
            addResult('info', 'ğŸ” Verificando erros JavaScript...');
            
            // Adicionar listener para erros
            let errorCount = 0;
            window.addEventListener('error', (e) => {
                errorCount++;
                addResult('error', `âŒ JavaScript Error: ${e.message}`);
            });
            
            setTimeout(() => {
                if (errorCount === 0) {
                    addResult('success', 'âœ… Nenhum erro JavaScript detectado');
                } else {
                    addResult('error', `âŒ ${errorCount} erros JavaScript detectados`);
                }
                
                addResult('info', 'ğŸ DiagnÃ³stico completo finalizado');
            }, 2000);
        }
        
        // Executar diagnÃ³stico bÃ¡sico automaticamente
        window.onload = () => {
            addResult('info', 'ğŸš€ Sistema iniciado - Ready para diagnÃ³stico');
        };
    </script>
</body>
</html>