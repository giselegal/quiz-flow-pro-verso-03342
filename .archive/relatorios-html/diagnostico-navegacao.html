<!DOCTYPE html>
<html>

<head>
    <title>Teste de Navega√ß√£o - Diagn√≥stico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }

        .test-section {
            border: 1px solid #ccc;
            margin: 20px 0;
            padding: 15px;
        }

        .button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            margin: 5px;
        }

        .button:hover {
            background: #0056b3;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .success {
            background: #d4edda;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>

<body>
    <h1>üîç Diagn√≥stico de Navega√ß√£o - Quiz Quest</h1>

    <div class="test-section">
        <h2>1. Teste de Acesso Direto √†s P√°ginas</h2>
        <p>Teste se as p√°ginas carregam diretamente na URL:</p>

        <button class="button" onclick="testDirectAccess('/admin/funis')">
            üìã Testar /admin/funis
        </button>

        <button class="button" onclick="testDirectAccess('/editor')">
            ‚úèÔ∏è Testar /editor
        </button>

        <button class="button" onclick="testDirectAccess('/editor/test-123')">
            ‚úèÔ∏è Testar /editor/test-123
        </button>

        <button class="button" onclick="testDirectAccess('/editor-templates')">
            üé® Testar /editor-templates
        </button>

        <div id="direct-access-results"></div>
    </div>

    <div class="test-section">
        <h2>2. Teste de Navega√ß√£o Program√°tica</h2>
        <p>Simular navega√ß√£o como o app faria:</p>

        <button class="button" onclick="testProgrammaticNavigation()">
            üîó Simular setLocation('/editor/test-funnel')
        </button>

        <button class="button" onclick="testWithParams()">
            üîó Testar com Par√¢metros (?template=test)
        </button>

        <div id="programmatic-results"></div>
    </div>

    <div class="test-section">
        <h2>3. Status do Servidor</h2>
        <button class="button" onclick="checkServerStatus()">
            üè• Verificar Status do Servidor
        </button>

        <div id="server-status"></div>
    </div>

    <div class="test-section">
        <h2>4. Console Logs</h2>
        <p>Abra o Console (F12) para ver logs detalhados dos testes.</p>
        <div id="console-output"
            style="background: #f8f9fa; padding: 10px; font-family: monospace; white-space: pre-wrap; max-height: 200px; overflow-y: auto;">
        </div>
    </div>

    <script>
        // Fun√ß√£o para logs vis√≠veis
        function log(message, type = 'info') {
            const output = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;

            console.log(`[TESTE] ${message}`);
        }

        // Teste de acesso direto
        async function testDirectAccess(url) {
            log(`Testando acesso direto: ${url}`);

            try {
                const fullUrl = window.location.origin + url;
                const response = await fetch(fullUrl);

                if (response.ok) {
                    log(`‚úÖ ${url} - Status: ${response.status}`, 'success');

                    // Verificar se retorna HTML (SPA)
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('text/html')) {
                        log(`‚úÖ ${url} - Retorna HTML (SPA correto)`, 'success');
                    } else {
                        log(`‚ö†Ô∏è ${url} - Content-Type: ${contentType}`, 'error');
                    }
                } else {
                    log(`‚ùå ${url} - Status: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå ${url} - Erro: ${error.message}`, 'error');
            }
        }

        // Teste de navega√ß√£o program√°tica
        function testProgrammaticNavigation() {
            log('Testando navega√ß√£o program√°tica...');

            // Simular como o wouter funciona
            const testUrl = '/editor/test-funnel-programmatic';

            log(`Tentando navegar para: ${testUrl}`);

            // Simular pushState (como wouter faz)
            try {
                window.history.pushState({}, '', testUrl);
                log(`‚úÖ history.pushState para ${testUrl} funcionou`, 'success');

                // Verificar se a URL mudou
                if (window.location.pathname === testUrl) {
                    log(`‚úÖ URL atualizada corretamente: ${window.location.href}`, 'success');
                } else {
                    log(`‚ùå URL n√£o mudou. Atual: ${window.location.pathname}`, 'error');
                }

                // Voltar para p√°gina original
                setTimeout(() => {
                    window.history.back();
                    log('üîÑ Voltando para p√°gina original');
                }, 2000);

            } catch (error) {
                log(`‚ùå Erro na navega√ß√£o: ${error.message}`, 'error');
            }
        }

        // Teste com par√¢metros
        function testWithParams() {
            log('Testando navega√ß√£o com par√¢metros...');

            const testUrl = '/editor/test-params?template=quiz-estilo&funnel=test-123';

            try {
                window.history.pushState({}, '', testUrl);
                log(`‚úÖ Navega√ß√£o com params: ${testUrl}`, 'success');

                // Verificar parsing dos par√¢metros
                const params = new URLSearchParams(window.location.search);
                const template = params.get('template');
                const funnel = params.get('funnel');

                log(`‚úÖ Par√¢metros: template=${template}, funnel=${funnel}`, 'success');

                setTimeout(() => {
                    window.history.back();
                    log('üîÑ Voltando para p√°gina original');
                }, 3000);

            } catch (error) {
                log(`‚ùå Erro nos par√¢metros: ${error.message}`, 'error');
            }
        }

        // Verificar status do servidor
        async function checkServerStatus() {
            log('Verificando status do servidor...');

            try {
                // Testar endpoint de health
                const healthResponse = await fetch('/health');
                if (healthResponse.ok) {
                    const data = await healthResponse.json();
                    log(`‚úÖ Servidor funcionando: ${JSON.stringify(data)}`, 'success');
                } else {
                    log(`‚ö†Ô∏è Health check falhou: ${healthResponse.status}`, 'error');
                }

                // Testar arquivos est√°ticos
                const staticResponse = await fetch('/assets/index.css');
                if (staticResponse.ok) {
                    log(`‚úÖ Arquivos est√°ticos acess√≠veis`, 'success');
                } else {
                    log(`‚ö†Ô∏è Arquivos est√°ticos: ${staticResponse.status}`, 'error');
                }

            } catch (error) {
                log(`‚ùå Erro no servidor: ${error.message}`, 'error');
            }
        }

        // Log inicial
        log('=== TESTE DE DIAGN√ìSTICO INICIADO ===');
        log(`URL atual: ${window.location.href}`);
        log(`User Agent: ${navigator.userAgent}`);

        // Verificar se est√° rodando no localhost
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            log('‚úÖ Rodando em ambiente local', 'success');
        } else {
            log(`‚ö†Ô∏è Rodando em: ${window.location.hostname}`, 'info');
        }
    </script>
</body>

</html>