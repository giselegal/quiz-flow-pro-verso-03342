# üìã PLANO DE A√á√ÉO EXECUTIVO
## Corre√ß√£o de Gargalos e Pontos Cegos - Quiz Flow Pro

**Data:** 13 de Novembro de 2025  
**Prioridade:** üî¥ CR√çTICA  
**Timeline:** 17 semanas (4 meses)  
**Status:** üìã Aguardando Aprova√ß√£o

---

## üéØ VIS√ÉO GERAL

Este documento apresenta o **plano executivo de a√ß√£o** para corre√ß√£o dos gargalos e pontos cegos identificados na an√°lise sistem√°tica do projeto.

### Situa√ß√£o Atual

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  STATUS DO PROJETO                                          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚úÖ Performance Runtime: EXCELENTE (180KB, ~2s TTI)        ‚îÇ
‚îÇ  ‚úÖ Qualidade de Tipos: MELHORADA (28 @ts-nocheck)         ‚îÇ
‚îÇ  üî¥ Arquitetura: CR√çTICA (239 servi√ßos, 17 duplicados)     ‚îÇ
‚îÇ  üî¥ Testes: CR√çTICO (5% cobertura)                          ‚îÇ
‚îÇ  üî¥ Seguran√ßa: DESCONHECIDA (n√£o auditada)                  ‚îÇ
‚îÇ  üî¥ Organiza√ß√£o: CR√çTICA (113 arquivos na raiz)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Objetivo

Transformar o projeto de "funcionando mas dif√≠cil de manter" para "sustent√°vel e escal√°vel".

---

## üö¶ ESTRAT√âGIA DE EXECU√á√ÉO

### Abordagem em Fases

```
FASE 0: Quick Wins        ‚ö° 1 semana    ‚Üí Ganhos imediatos
         ‚Üì
FASE 1: Estabiliza√ß√£o     üõ°Ô∏è 4 semanas   ‚Üí Eliminar riscos
         ‚Üì
FASE 2: Consolida√ß√£o      üèóÔ∏è 8 semanas   ‚Üí Simplificar arquitetura
         ‚Üì
FASE 3: Otimiza√ß√£o        ‚ö° 4 semanas   ‚Üí Performance e escala
```

### Princ√≠pios Orientadores

1. **Incremental** - Mudan√ßas pequenas e frequentes
2. **Testado** - Cada mudan√ßa coberta por testes
3. **Revers√≠vel** - Sempre poss√≠vel fazer rollback
4. **Monitorado** - M√©tricas em cada etapa
5. **Documentado** - Decis√µes e rationale registrados

---

## ‚ö° FASE 0: QUICK WINS (Semana 1)

### Objetivo
Ganhos r√°pidos, baixo risco, alto impacto vis√≠vel

### üéØ 6 A√ß√µes Priorit√°rias

#### 1. Remover C√≥digo Deprecated (4h)
**O que:** Mover pastas `__deprecated` e `deprecated` para `.archive/`

```bash
# Comandos
mkdir -p .archive/deprecated/
mv src/services/__deprecated .archive/deprecated/services
mv src/services/deprecated .archive/deprecated/services-legacy
git rm -r src/services/__deprecated src/services/deprecated
```

**Por que:**
- ‚úÖ Reduz confus√£o (desenvolvedores n√£o usam acidentalmente)
- ‚úÖ Melhora bundle size (~5-10KB)
- ‚úÖ Facilita navega√ß√£o no c√≥digo

**Risco:** üü¢ Baix√≠ssimo (c√≥digo j√° marcado como deprecated)

---

#### 2. Consolidar Documenta√ß√£o (8h)
**O que:** Organizar 113 arquivos da raiz em estrutura clara

```bash
# Estrutura proposta
docs/
‚îú‚îÄ‚îÄ auditorias/       # 15 relat√≥rios AUDITORIA_*.md
‚îú‚îÄ‚îÄ sprints/          # 6 documentos SPRINT_*.md
‚îú‚îÄ‚îÄ guias/            # 5 documentos GUIA_*.md
‚îú‚îÄ‚îÄ analises/         # 10 documentos ANALISE_*.md
‚îú‚îÄ‚îÄ relatorios/       # 8 documentos RELATORIO_*.md
‚îî‚îÄ‚îÄ INDEX.md          # √çndice master de toda documenta√ß√£o
```

**Por que:**
- ‚úÖ Onboarding 50% mais r√°pido
- ‚úÖ Decis√µes encontr√°veis
- ‚úÖ Raiz do projeto limpa

**Risco:** üü¢ Zero (apenas mover arquivos)

---

#### 3. Padronizar TODOs (4h)
**O que:** Adicionar metadata obrigat√≥ria em todos os TODOs

```typescript
// ‚ùå Antes (159 casos)
// TODO: Fix this
// TODO: Refactor

// ‚úÖ Depois
// TODO(@username, 2025-11-15, P2): Refatorar servi√ßo para usar cache unificado
// FIXME(@username, 2025-11-13, P1): Bug - bot√£o n√£o funciona em mobile
```

**Por que:**
- ‚úÖ TODOs rastre√°veis
- ‚úÖ Prioriza√ß√£o clara
- ‚úÖ Accountability

**Risco:** üü¢ Zero (apenas adicionar coment√°rios)

---

#### 4. Bundle Analysis (2h)
**O que:** Gerar visualiza√ß√£o do bundle para identificar oportunidades

```bash
# Comandos
npm run build -- --mode production
npm install -D webpack-bundle-analyzer source-map-explorer
npm run analyze

# Criar script
npm pkg set scripts.analyze="vite-bundle-visualizer"
```

**Por que:**
- ‚úÖ Identificar c√≥digo duplicado
- ‚úÖ Encontrar depend√™ncias pesadas
- ‚úÖ Validar tree-shaking

**Risco:** üü¢ Zero (apenas an√°lise)

---

#### 5. Audit de Secrets (3h)
**O que:** Escanear c√≥digo e hist√≥rico git por secrets vazados

```bash
# Comandos
npm install -D git-secrets
git secrets --install
git secrets --scan-history

npm audit --audit-level=moderate
npm audit fix

# Criar relat√≥rio
npm audit --json > .security/npm-audit-report.json
```

**Por que:**
- ‚úÖ Prevenir vazamento de dados
- ‚úÖ Compliance com GDPR/LGPD
- ‚úÖ Identificar vulnerabilidades

**Risco:** üü¢ Zero (apenas scan)

---

#### 6. Path Aliases Consistentes (4h)
**O que:** Configurar imports padronizados

```json
// tsconfig.json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["src/*"],
      "@components/*": ["src/components/*"],
      "@services/*": ["src/services/*"],
      "@hooks/*": ["src/hooks/*"],
      "@utils/*": ["src/utils/*"],
      "@types/*": ["src/types/*"]
    }
  }
}
```

**Script de migra√ß√£o:**
```bash
# Converter imports relativos profundos
find src -name "*.ts" -o -name "*.tsx" | xargs sed -i 's|from "../../../services|from "@services|g'
```

**Por que:**
- ‚úÖ Imports limpos e leg√≠veis
- ‚úÖ Refatora√ß√£o facilitada
- ‚úÖ IDE autocomplete melhorado

**Risco:** üü° Baixo (testes validam)

---

### Entrega Semana 1

| Item | Resultado Esperado |
|------|-------------------|
| **C√≥digo deprecated** | Removido da base |
| **Documenta√ß√£o** | Organizada em docs/ |
| **TODOs** | Todos com metadata |
| **Bundle** | Relat√≥rio visual gerado |
| **Seguran√ßa** | Relat√≥rio de audit |
| **Imports** | Path aliases configurados |

**Impacto Total:**
- üßπ Raiz limpa (113 ‚Üí 10 arquivos)
- üìö Documenta√ß√£o naveg√°vel
- üéØ TODOs acion√°veis
- üîç Visibilidade do bundle
- üîí Postura de seguran√ßa conhecida
- üì¶ Imports modernos

---

## üõ°Ô∏è FASE 1: ESTABILIZA√á√ÉO (Semanas 2-5)

### Objetivo
Eliminar riscos cr√≠ticos e estabelecer funda√ß√£o s√≥lida

### Semana 2-3: Seguran√ßa e Qualidade

#### 7. Auditoria de Seguran√ßa Completa (16h)

**Checklist de Seguran√ßa:**

```markdown
## Auditoria de Seguran√ßa - Checklist

### 1. Depend√™ncias
- [ ] `npm audit` executado e vulnerabilidades corrigidas
- [ ] Depend√™ncias desatualizadas identificadas
- [ ] Licen√ßas de depend√™ncias verificadas

### 2. Autentica√ß√£o e Autoriza√ß√£o
- [ ] Supabase RLS policies configuradas
- [ ] Row Level Security testado
- [ ] Roles e permiss√µes documentadas
- [ ] Tokens JWT validados

### 3. Prote√ß√£o contra Ataques
- [ ] XSS - Inputs sanitizados
- [ ] CSRF - Tokens implementados
- [ ] SQL Injection - ORMs/prepared statements
- [ ] Clickjacking - X-Frame-Options configurado
- [ ] CORS - Whitelist configurada

### 4. Gest√£o de Secrets
- [ ] .env n√£o commitado
- [ ] Secrets n√£o no bundle frontend
- [ ] Secrets n√£o em logs
- [ ] Rotation policy documentada

### 5. Dados Sens√≠veis
- [ ] PII identificada e protegida
- [ ] Encryption at rest configurado
- [ ] Encryption in transit (HTTPS)
- [ ] GDPR/LGPD compliance

### 6. Logging e Monitoring
- [ ] Logs n√£o cont√™m PII
- [ ] Failed login attempts monitorados
- [ ] Suspicious activity alerting
```

**Deliverable:** `SECURITY.md` com findings e status

---

#### 8. An√°lise @ts-nocheck Remanescentes (8h)

**Os 28 arquivos remanescentes:**

```bash
# Listar todos
grep -r "@ts-nocheck" src --include="*.ts" --include="*.tsx" -l

# Categorizar por criticidade
# - P1 (Cr√≠tico): Servi√ßos core, componentes principais
# - P2 (Alto): Hooks, utils importantes
# - P3 (M√©dio): Componentes secund√°rios
# - P4 (Baixo): Testes, exemplos
```

**Plano de Corre√ß√£o:**
1. Corrigir P1 (cr√≠ticos) - 4h
2. Corrigir P2 (altos) - 3h
3. Documentar blockers para P3/P4 - 1h

**Meta:** Zero @ts-nocheck em c√≥digo cr√≠tico

---

#### 9. Justificar @ts-ignore (4h)

**Template obrigat√≥rio:**
```typescript
// ‚ùå Antes
// @ts-ignore
const value = something.property;

// ‚úÖ Depois
// @ts-ignore - Biblioteca externa sem tipos adequados (issue #1234)
// TODO(@username, 2025-12-01, P3): Contribuir tipos para biblioteca ou usar alternativa
const value = something.property;
```

**Deliverable:** Todos os 41 @ts-ignore documentados

---

### Semana 4-5: Testes e Monitoramento

#### 10. Testes para Servi√ßos Cr√≠ticos (24h)

**Prioridade 1: Servi√ßos Core**

##### FunnelService (8h)
```typescript
describe('FunnelService', () => {
  describe('createFunnel', () => {
    it('should create funnel with valid data')
    it('should validate required fields')
    it('should generate unique funnel ID')
    it('should set default values')
    // ... 20+ test cases
  });
  
  describe('updateFunnel', () => { /* ... */ });
  describe('deleteFunnel', () => { /* ... */ });
  describe('getFunnelById', () => { /* ... */ });
});

// Target: 80%+ coverage
```

##### TemplateService (8h)
```typescript
describe('TemplateService', () => {
  describe('loadTemplate', () => {
    it('should load from JSON first')
    it('should fallback to API on JSON miss')
    it('should cache loaded templates')
    it('should handle network errors')
    // ... 15+ test cases
  });
  
  describe('prepareTemplate', () => { /* ... */ });
  describe('validateTemplate', () => { /* ... */ });
});

// Target: 80%+ coverage
```

##### StorageService (4h)
##### EditorService (4h)

**Resultado Esperado:**
- 4 servi√ßos com 80%+ coverage
- Testes de integra√ß√£o end-to-end
- CI/CD pipeline validando testes

---

#### 11. Configurar Monitoramento (12h)

**Stack de Monitoramento:**

```typescript
// 1. Error Tracking - Sentry
import * as Sentry from "@sentry/react";

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 0.1,
  integrations: [
    new Sentry.BrowserTracing(),
    new Sentry.Replay()
  ],
});

// 2. Analytics - PostHog
import posthog from 'posthog-js';

posthog.init(process.env.POSTHOG_KEY, {
  api_host: 'https://app.posthog.com',
  autocapture: false // Manual tracking
});

// 3. Performance - Web Vitals
import { getCLS, getFID, getFCP, getLCP, getTTFB } from 'web-vitals';

function sendToAnalytics(metric) {
  posthog.capture('web-vitals', metric);
}

getCLS(sendToAnalytics);
getFID(sendToAnalytics);
getFCP(sendToAnalytics);
getLCP(sendToAnalytics);
getTTFB(sendToAnalytics);
```

**Dashboard de M√©tricas:**
- Error rate por p√°gina
- Performance metrics (CWV)
- User flows (convers√£o)
- Feature usage
- Geographic distribution

**Alerting:**
- Error rate > 1%
- LCP > 2.5s
- FID > 100ms
- Server response > 500ms

---

### Entrega Fase 1 (Semana 5)

| Item | Resultado Esperado |
|------|-------------------|
| **Seguran√ßa** | SECURITY.md com audit completo |
| **@ts-nocheck** | Zero em c√≥digo cr√≠tico |
| **@ts-ignore** | Todos justificados |
| **Testes** | 4 servi√ßos com 80% coverage |
| **Monitoramento** | Sentry + PostHog + Web Vitals |

**Impacto Total:**
- üîí Postura de seguran√ßa s√≥lida
- üéØ Qualidade de c√≥digo garantida
- üß™ Refatora√ß√£o segura (testes)
- üìä Visibilidade de problemas (monitoramento)

---

## üèóÔ∏è FASE 2: CONSOLIDA√á√ÉO (Semanas 6-13)

### Objetivo
Simplificar arquitetura, eliminar duplica√ß√£o

### Sprint 1 (Semanas 6-7): Componentes Core

#### 12. Consolidar ComponentRegistry (10h)

**Problema:** 2 vers√µes diferentes de ComponentRegistry

**An√°lise:**
```bash
# Encontrar todas as vers√µes
find src -name "ComponentRegistry.tsx"
# src/components/editor/ComponentRegistry.tsx
# src/components/registry/ComponentRegistry.tsx

# Analisar diferen√ßas
diff -u src/components/editor/ComponentRegistry.tsx \
        src/components/registry/ComponentRegistry.tsx
```

**Decis√£o:** Escolher vers√£o can√¥nica baseada em:
1. Mais completa
2. Melhor testada
3. Mais usada (grep imports)

**Plano:**
1. Identificar vers√£o can√¥nica (2h)
2. Migrar funcionalidade √∫nica (3h)
3. Criar testes abrangentes (3h)
4. Migrar imports (1h)
5. Remover duplicata (1h)

---

#### 13. Consolidar BlockRenderer (10h)
#### 14. Consolidar ComponentRenderer (10h)

**Total Sprint 1:** 30h sobre componentes core

---

### Sprint 2 (Semanas 8-9): Estrutura de Services

#### 15. Eliminar Aliases (24h)

**Problema:** Pasta `aliases/` cria m√∫ltiplos caminhos para mesmo c√≥digo

**Invent√°rio:**
```bash
# Mapear todos os aliases
find src/services/aliases -type f

# Para cada alias, encontrar uso
grep -r "from '@services/aliases" src --include="*.ts" --include="*.tsx"
```

**Plano:**
1. Mapear aliases ‚Üí implementa√ß√£o real (4h)
2. Criar script de migra√ß√£o autom√°tica (4h)
3. Executar migra√ß√£o (2h)
4. Validar com testes (2h)
5. Remover pasta aliases/ (2h)
6. Atualizar documenta√ß√£o (2h)

**Script de Migra√ß√£o:**
```typescript
// scripts/migrate-aliases.ts
import { Project } from 'ts-morph';

const project = new Project({
  tsConfigFilePath: 'tsconfig.json',
});

const aliasMap = {
  '@services/aliases/funnelService': '@services/core/FunnelService',
  '@services/aliases/templateService': '@services/templates/TemplateService',
  // ... etc
};

project.getSourceFiles().forEach(sourceFile => {
  // Replace imports
  sourceFile.getImportDeclarations().forEach(importDecl => {
    const moduleSpecifier = importDecl.getModuleSpecifierValue();
    if (aliasMap[moduleSpecifier]) {
      importDecl.setModuleSpecifier(aliasMap[moduleSpecifier]);
    }
  });
  
  sourceFile.saveSync();
});
```

---

#### 16. Consolidar FunnelService (16h)

**Problema:** 4 implementa√ß√µes de FunnelService

**An√°lise:**
```
1. FunnelService.ts               (180 LOC) - v1 original
2. EnhancedFunnelService.ts       (156 LOC) - v2 com features
3. FunnelUnifiedService.ts        (1,303 LOC) - tentativa unifica√ß√£o
4. ConsolidatedFunnelService.ts   (395 LOC) - consolida√ß√£o mais recente
```

**Estrat√©gia:**
1. Analisar diferen√ßas (4h)
2. Escolher base (ConsolidatedFunnelService)
3. Migrar features √∫nicas (6h)
4. Testes E2E (4h)
5. Deprecar vers√µes antigas (2h)

---

### Sprint 3 (Semanas 10-11): Templates e Storage

#### 17. Consolidar TemplateService (40h)

**Problema:** 10 implementa√ß√µes diferentes

**Abordagem 3-Tier (conforme docs/TEMPLATE_SYSTEM.md):**
```
Tier 1: Built-in JSON     (fastest, zero latency)
Tier 2: Hierarchical API  (medium, cached)
Tier 3: Legacy Registry   (slowest, fallback)
```

**Plano detalhado em:** `docs/TEMPLATE_SYSTEM.md`

---

#### 18. Consolidar StorageService (16h)

---

### Sprint 4 (Semanas 12-13): Cleanup Final

#### 19. Reorganizar Estrutura de Blocks (16h)

**Problema:** Blocos espalhados em 3 pastas

**Estrutura Proposta:**
```
src/components/blocks/
‚îú‚îÄ‚îÄ core/              # Blocos fundamentais (Button, Text, Image)
‚îú‚îÄ‚îÄ quiz/              # Blocos espec√≠ficos de quiz (Question, Options, Timer)
‚îú‚îÄ‚îÄ funnel/            # Blocos de funil (CTA, Lead Form, Progress)
‚îú‚îÄ‚îÄ layout/            # Blocos de layout (Container, Grid, Spacer)
‚îî‚îÄ‚îÄ advanced/          # Blocos avan√ßados (Chart, Video, Embed)
```

**Migra√ß√£o:**
1. Criar nova estrutura (2h)
2. Mover componentes (6h)
3. Atualizar imports automaticamente (4h)
4. Validar com testes (2h)
5. Atualizar documenta√ß√£o (2h)

---

#### 20. Conven√ß√£o de Testes (8h)

**Decis√£o:** Co-located tests (pr√≥ximos ao c√≥digo)

**Estrutura:**
```
src/services/
‚îú‚îÄ‚îÄ FunnelService.ts
‚îú‚îÄ‚îÄ FunnelService.test.ts          ‚úÖ Co-located
‚îú‚îÄ‚îÄ TemplateService.ts
‚îî‚îÄ‚îÄ TemplateService.test.ts

src/components/
‚îú‚îÄ‚îÄ Button/
‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îú‚îÄ‚îÄ Button.test.tsx            ‚úÖ Co-located
‚îÇ   ‚îî‚îÄ‚îÄ Button.stories.tsx
```

**Migra√ß√£o:**
1. Mover testes (3h)
2. Remover `src/__tests__/legacy-tests/` (1h)
3. Atualizar vitest.config.ts (1h)
4. Documentar em CONTRIBUTING.md (2h)
5. Atualizar CI (1h)

---

### Entrega Fase 2 (Semana 13)

| Item | Resultado Esperado |
|------|-------------------|
| **Componentes core** | Sem duplica√ß√£o |
| **Aliases** | Eliminados |
| **FunnelService** | Unificado |
| **TemplateService** | Arquitetura 3-tier |
| **StorageService** | Consolidado |
| **Estrutura blocks** | Organizada |
| **Conven√ß√£o testes** | Definida e migrada |

**Impacto Total:**
- üéØ 50% menos servi√ßos (239 ‚Üí 120)
- üì¶ Bundle 15% menor
- üß† Clareza arquitetural
- üöÄ Velocity aumentada 30%

---

## ‚ö° FASE 3: OTIMIZA√á√ÉO (Semanas 14-17)

### Objetivo
Melhorar performance e preparar para escala

### Semana 14-15: Performance em Escala

#### 21. Testes de Stress (16h)

**Cen√°rios de Teste:**

```typescript
// 1. Editor com 50+ steps
describe('Editor - Large Funnel', () => {
  it('should load 50-step funnel in < 3s', async () => {
    const funnel = generateFunnel(50);
    const startTime = performance.now();
    await loadFunnel(funnel.id);
    const loadTime = performance.now() - startTime;
    expect(loadTime).toBeLessThan(3000);
  });
  
  it('should navigate between steps smoothly', () => {
    // FPS should stay > 50
  });
});

// 2. Dashboard com 100+ funnels
describe('Dashboard - Many Funnels', () => {
  it('should render 100 funnels in < 2s', () => {
    // Virtualization test
  });
});

// 3. Performance em 3G
describe('Network - Slow Connection', () => {
  beforeEach(() => {
    // Simulate 3G (750ms latency, 400kbps)
  });
  
  it('should show loading state immediately');
  it('should load critical content first');
  it('should work offline after first load');
});

// 4. Low-end devices
describe('Device - Low-End', () => {
  // CPU throttling 4x
  // Memory limit 512MB
});
```

**Resultado:** Report de performance + otimiza√ß√µes necess√°rias

---

### Semana 16: Dados e Integridade

#### 22. Estrat√©gia de Migra√ß√£o de Dados (16h)

**Sistema de Versionamento:**

```typescript
// Schema versioning
interface SchemaVersion {
  version: number;
  migratedAt: Date;
  migratedBy: string;
}

// Migration runner
async function runMigrations() {
  const currentVersion = await getCurrentSchemaVersion();
  const targetVersion = getLatestSchemaVersion();
  
  for (let v = currentVersion + 1; v <= targetVersion; v++) {
    await runMigration(v);
  }
}

// Example migration
async function migration_v31_to_v32() {
  // 1. Backup
  await backupDatabase();
  
  // 2. Migrate
  await db.transaction(async (tx) => {
    // Schema changes
    await tx.execute(/* SQL */);
    
    // Data transformations
    await transformData(tx);
  });
  
  // 3. Validate
  await validateMigration();
  
  // 4. Update version
  await updateSchemaVersion(32);
}
```

**Deliverables:**
- `migrations/` pasta com scripts versionados
- Rollback procedures documentadas
- Backup strategy automatizada

---

#### 23. Garantir Integridade de Dados (16h)

**Valida√ß√µes Backend:**

```typescript
// Zod schemas para valida√ß√£o
import { z } from 'zod';

const FunnelSchema = z.object({
  id: z.string().uuid(),
  name: z.string().min(1).max(100),
  steps: z.array(StepSchema).min(1),
  createdBy: z.string().uuid(),
  // ...
});

// Middleware de valida√ß√£o
app.post('/api/funnels', async (req, res) => {
  const result = FunnelSchema.safeParse(req.body);
  
  if (!result.success) {
    return res.status(400).json({
      error: 'Validation failed',
      details: result.error.flatten()
    });
  }
  
  // Proceed with valid data
  await createFunnel(result.data);
});
```

**DB Constraints:**

```sql
-- funnels table
CREATE TABLE funnels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name TEXT NOT NULL CHECK (length(name) > 0 AND length(name) <= 100),
  created_by UUID NOT NULL REFERENCES users(id),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  
  -- Prevent orphaned records
  CONSTRAINT fk_created_by FOREIGN KEY (created_by)
    REFERENCES users(id) ON DELETE CASCADE
);

-- Indexes for performance
CREATE INDEX idx_funnels_created_by ON funnels(created_by);
CREATE INDEX idx_funnels_created_at ON funnels(created_at DESC);
```

---

### Semana 17: M√©tricas de Neg√≥cio

#### 24. KPIs e Dashboard (16h)

**KPIs Cr√≠ticos:**

```typescript
// 1. Funnel Conversion Rate
const conversionRate = (completed / started) * 100;

// 2. Step Abandonment
const abandonmentByStep = steps.map(step => ({
  step: step.number,
  abandonmentRate: (abandoned[step] / started) * 100
}));

// 3. Average Completion Time
const avgTime = totalTime / completed;

// 4. Error Rate by Quiz Type
const errorsByType = groupBy(errors, 'quizType');

// 5. Performance by Browser
const performanceByBrowser = groupBy(metrics, 'browser');
```

**Dashboard de M√©tricas:**

```typescript
// Dashboard component
function MetricsDashboard() {
  const { data: metrics } = useMetrics({
    dateRange: 'last-30-days'
  });
  
  return (
    <Grid>
      <Card title="Conversion Rate">
        <LineChart data={metrics.conversionRate} />
        <Alert type={metrics.conversionRate < 60 ? 'warning' : 'success'}>
          {metrics.conversionRate}% conversion
        </Alert>
      </Card>
      
      <Card title="Abandonment Heatmap">
        <Heatmap data={metrics.abandonmentByStep} />
      </Card>
      
      <Card title="Performance">
        <Gauge
          value={metrics.avgLoadTime}
          max={3000}
          label="Avg Load Time (ms)"
        />
      </Card>
      
      <Card title="Errors">
        <BarChart data={metrics.errorsByType} />
      </Card>
    </Grid>
  );
}
```

**Alerting:**

```typescript
// Alert rules
const alertRules = [
  {
    metric: 'conversionRate',
    condition: (value) => value < 50,
    severity: 'critical',
    action: notifyTeam
  },
  {
    metric: 'errorRate',
    condition: (value) => value > 1,
    severity: 'high',
    action: notifyOnCall
  },
  {
    metric: 'avgLoadTime',
    condition: (value) => value > 2500,
    severity: 'medium',
    action: createTicket
  }
];
```

---

### Entrega Fase 3 (Semana 17)

| Item | Resultado Esperado |
|------|-------------------|
| **Testes de stress** | Report + otimiza√ß√µes |
| **Migra√ß√£o de dados** | Sistema versionado |
| **Integridade de dados** | Valida√ß√µes + constraints |
| **KPIs** | Dashboard + alerting |

**Impacto Total:**
- ‚ö° Performance garantida em escala
- üîí Dados √≠ntegros e migr√°veis
- üìä Visibilidade de neg√≥cio
- üö® Alerting proativo

---

## üìä M√âTRICAS DE SUCESSO

### KPIs de Acompanhamento

**Weekly Metrics:**

| M√©trica | Baseline | Semana 1 | Semana 5 | Semana 13 | Semana 17 | Meta |
|---------|----------|----------|----------|-----------|-----------|------|
| **Servi√ßos** | 239 | 237 | 230 | 140 | 120 | 120 |
| **Duplicados** | 17 | 15 | 10 | 2 | 0 | 0 |
| **@ts-nocheck** | 28 | 18 | 5 | 0 | 0 | 0 |
| **Cobertura Testes** | 5% | 8% | 25% | 55% | 70% | 70% |
| **Arquivos Raiz** | 113 | 10 | 10 | 10 | 10 | 10 |
| **Vulnerabilidades** | ? | 0 | 0 | 0 | 0 | 0 |

**Quality Gates:**

```yaml
# .github/workflows/quality-gates.yml
name: Quality Gates

on: [pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    steps:
      - name: Check test coverage
        run: |
          npm run test:coverage
          # Fail if < 70%
      
      - name: Check bundle size
        run: |
          npm run build
          # Fail if > 200KB
      
      - name: Check TypeScript
        run: |
          npm run type-check
          # Fail if @ts-nocheck found
      
      - name: Security audit
        run: |
          npm audit --audit-level=moderate
          # Fail if vulnerabilities found
```

---

## üí∞ OR√áAMENTO E RECURSOS

### Investimento por Fase

| Fase | Horas | Custo* | Dura√ß√£o | Recursos |
|------|-------|--------|---------|----------|
| **Fase 0** | 25h | $1,250 | 1 semana | 1 dev |
| **Fase 1** | 64h | $3,200 | 4 semanas | 1-2 devs |
| **Fase 2** | 144h | $7,200 | 8 semanas | 2 devs |
| **Fase 3** | 64h | $3,200 | 4 semanas | 1-2 devs |
| **TOTAL** | **297h** | **$14,850** | **17 semanas** | **1-2 devs** |

*Assumindo $50/h custo dev

### ROI Projetado

**Economia em Produtividade:**
- Time: 4 desenvolvedores
- Perda atual: 112h por sprint (confus√£o, bugs, refatora√ß√£o lenta)
- Perda ap√≥s corre√ß√µes: 30h por sprint
- **Economia: 82h por sprint**

**Payback:**
- Investimento: 297 horas
- Economia: 82h por sprint (2 semanas)
- **Payback: 3.6 sprints = 7.2 semanas**

**ROI em 12 meses:**
- Sprints em 12 meses: 26
- Economia total: 26 √ó 82h = 2,132 horas
- **ROI: 717% em 12 meses**
- **Economia: $106,600 em 1 ano** (vs investimento de $14,850)

---

## üö® RISCOS E MITIGA√á√ïES

### Principais Riscos

| Risco | Probabilidade | Impacto | Mitiga√ß√£o |
|-------|--------------|---------|-----------|
| **Resist√™ncia do time** | M√©dia | Alto | Comunica√ß√£o clara, ganhos r√°pidos vis√≠veis |
| **Regress√µes durante refatora√ß√£o** | Alta | Alto | Testes abrangentes, rollback f√°cil |
| **Scope creep** | M√©dia | M√©dio | Plano r√≠gido, no extras durante execu√ß√£o |
| **Descoberta de problemas maiores** | M√©dia | Alto | Buffer de 20% no cronograma |
| **Perda de contexto** | Baixa | Alto | Documenta√ß√£o cont√≠nua, pair programming |

### Conting√™ncias

```
SE algo der errado:
  1. STOP - n√£o prosseguir
  2. ROLLBACK - voltar ao estado anterior
  3. ANALYZE - entender o problema
  4. ADJUST - ajustar plano
  5. RESUME - continuar com seguran√ßa
```

---

## üìû GOVERNAN√áA E COMUNICA√á√ÉO

### Estrutura de Comunica√ß√£o

```
Daily:
  - Standup (15 min)
  - Status no Slack
  
Weekly:
  - Progress review (30 min)
  - Metrics dashboard review
  - Blockers & decisions
  
Bi-weekly:
  - Sprint planning (1h)
  - Sprint retro (1h)
  
Monthly:
  - Stakeholder update
  - ROI review
  - Plan adjustment
```

### Decis√µes e Aprova√ß√µes

| Decis√£o | Quem Decide | Quando |
|---------|-------------|--------|
| **Executar Fase 0** | Tech Lead | Imediato |
| **Executar Fase 1** | Engineering Manager | Ap√≥s Fase 0 |
| **Executar Fase 2** | VP Engineering | Ap√≥s Fase 1 |
| **Executar Fase 3** | VP Engineering | Ap√≥s Fase 2 |
| **Mudan√ßas no plano** | Tech Lead + EM | Conforme necess√°rio |

---

## ‚úÖ CHECKLIST DE APROVA√á√ÉO

### Fase 0 (Quick Wins)

- [ ] Plano revisado pelo Tech Lead
- [ ] Recursos alocados (1 dev)
- [ ] Cronograma validado
- [ ] Comunica√ß√£o enviada ao time
- [ ] **APROVA√á√ÉO PARA IN√çCIO**

### Fase 1 (Estabiliza√ß√£o)

Pr√©-requisitos:
- [ ] Fase 0 conclu√≠da com sucesso
- [ ] Resultados medidos e satisfat√≥rios
- [ ] Budget aprovado
- [ ] Recursos alocados (1-2 devs)
- [ ] **APROVA√á√ÉO PARA IN√çCIO**

### Fase 2 (Consolida√ß√£o)

Pr√©-requisitos:
- [ ] Fase 1 conclu√≠da com sucesso
- [ ] Cobertura de testes ‚â• 25%
- [ ] Zero vulnerabilidades cr√≠ticas
- [ ] Budget aprovado
- [ ] Recursos alocados (2 devs)
- [ ] **APROVA√á√ÉO PARA IN√çCIO**

### Fase 3 (Otimiza√ß√£o)

Pr√©-requisitos:
- [ ] Fase 2 conclu√≠da com sucesso
- [ ] Servi√ßos reduzidos ‚â• 40%
- [ ] Arquitetura consolidada
- [ ] Budget aprovado
- [ ] Recursos alocados (1-2 devs)
- [ ] **APROVA√á√ÉO PARA IN√çCIO**

---

## üéØ PR√ìXIMOS PASSOS IMEDIATOS

### Esta Semana

1. [ ] **Review deste plano** com Tech Lead e Engineering Manager
2. [ ] **Discuss√£o em reuni√£o de equipe** sobre impacto e timeline
3. [ ] **Aprova√ß√£o para Fase 0** (Quick Wins)
4. [ ] **Alocar desenvolvedor** para come√ßar Fase 0
5. [ ] **Criar board** de acompanhamento (Jira/Linear)

### Semana que Vem

6. [ ] **Kick-off Fase 0** (segunda-feira)
7. [ ] **Daily check-ins** para progresso
8. [ ] **Resolver blockers** conforme surgem
9. [ ] **Demonstra√ß√£o de resultados** (sexta-feira)
10. [ ] **Decis√£o sobre Fase 1** baseado em resultados

---

## üìö DOCUMENTOS DE SUPORTE

1. **ANALISE_SISTEMATICA_COMPLETA_GARGALOS_PONTOS_CEGOS.md**
   - An√°lise detalhada de 20 pontos cegos
   - Fundamenta√ß√£o t√©cnica

2. **Este Documento (PLANO_ACAO_EXECUTIVO_GARGALOS.md)**
   - Plano executivo de a√ß√£o
   - Timeline e recursos

3. **Relat√≥rios Existentes:**
   - ANALISE_ESTADO_PROJETO_GARGALOS.md
   - AUDITORIA_COMPLETA_PONTOS_CEGOS_RELATORIO_FINAL.md
   - RESUMO_EXECUTIVO_ANALISE.md

---

## üèÅ CONCLUS√ÉO

Este plano representa uma **abordagem estruturada e de baixo risco** para transformar o projeto Quiz Flow Pro de um sistema com excelente performance mas dif√≠cil manuten√ß√£o para um **exemplo de arquitetura limpa e sustent√°vel**.

### Por que executar este plano?

1. **ROI comprovado**: 717% em 12 meses
2. **Risco mitigado**: Abordagem incremental, sempre revers√≠vel
3. **Impacto mensur√°vel**: KPIs claros em cada etapa
4. **Vit√≥rias r√°pidas**: Resultados vis√≠veis na semana 1
5. **Funda√ß√£o s√≥lida**: Base para crescimento futuro

### O que N√ÉO fazer

‚ùå Ignorar o problema ("est√° funcionando, n√£o mexe")  
‚ùå Big bang rewrite (alto risco, baixo ROI)  
‚ùå Corre√ß√µes ad-hoc sem plano (desperd√≠cio de tempo)  
‚ùå Prosseguir sem m√©tricas (voo cego)

### O que fazer AGORA

‚úÖ **Aprovar Fase 0** (Quick Wins - 1 semana, baixo risco, alto impacto)  
‚úÖ **Alocar 1 desenvolvedor** para come√ßar esta semana  
‚úÖ **Medir resultados** e decidir sobre Fase 1  
‚úÖ **Comunicar plano** ao time completo

---

**Preparado por:** Agente de An√°lise e Planejamento  
**Data:** 13 de Novembro de 2025  
**Status:** üìã Aguardando Aprova√ß√£o  
**Pr√≥xima A√ß√£o:** Review com stakeholders

---

*"Excel√™ncia √© uma jornada, n√£o um destino. Cada passo neste plano nos aproxima de um sistema n√£o apenas funcional, mas sustent√°vel e escal√°vel."*

---

**APROVA√á√ÉO:**

- [ ] **Tech Lead:** _________________ Data: _______
- [ ] **Engineering Manager:** _________________ Data: _______
- [ ] **VP Engineering:** _________________ Data: _______

**FIM DO DOCUMENTO**
